# COEIROINK APIパラメータ調査結果

調査日: 2025-10-17

## 概要

COEIROINK v1 API (`/v1/synthesis`) のパラメータ範囲と仕様を調査し、実際のテストを通じて動作範囲を確認しました。

## 調査方法

1. **OpenAPI仕様の取得**: `http://localhost:50032/openapi.json` から公式API仕様を取得
2. **インターネット調査**: COEIROINK/VOICEVOXの使用例を調査
3. **実測テスト**: 様々なパラメータ値で音声合成を実行し、成功/失敗を記録

## 必須パラメータ

OpenAPI仕様から判明した `/v1/synthesis` エンドポイントの必須パラメータ:

```json
{
  "required": [
    "volumeScale",
    "pitchScale",
    "intonationScale",
    "prePhonemeLength",
    "postPhonemeLength",
    "outputSamplingRate",
    "speakerUuid",
    "styleId",
    "text",
    "speedScale"
  ]
}
```

## パラメータ範囲（実測結果）

### 1. speedScale（話速）

| 項目 | 値 |
|------|-----|
| **デフォルト値** | 1.0 |
| **推奨範囲** | 0.5〜2.0 |
| **実測動作範囲** | 0.1〜5.0 (全て成功) |
| **単位** | 倍率 |

**テスト結果:**
- ✓ 0.10 → 成功 (225,008 bytes) - 非常に遅い
- ✓ 0.50 → 成功 (71,756 bytes) - ゆっくり
- ✓ 1.00 → 成功 (52,250 bytes) - 標準速度
- ✓ 1.50 → 成功 (45,564 bytes) - やや速め
- ✓ 2.00 → 成功 (42,776 bytes) - 2倍速
- ✓ 5.00 → 成功 (36,090 bytes) - 非常に速い

**注意点:**
- 値が小さいほど音声ファイルサイズが大きくなる（発声時間が長いため）
- 0.5未満や2.0超は推奨範囲外の警告が出るが動作する
- 極端に小さい/大きい値は不自然な音声になる可能性

### 2. pitchScale（ピッチ）

| 項目 | 値 |
|------|-----|
| **デフォルト値** | 0.0 |
| **推奨範囲** | -0.15〜0.15 |
| **実測動作範囲** | -1.0〜1.0 (全て成功) |
| **単位** | 相対値 |

**テスト結果:**
- ✓ -1.00 → 成功 (52,250 bytes) - 極端に低い
- ✓ -0.50 → 成功 (52,250 bytes) - かなり低い
- ✓ -0.15 → 成功 (52,250 bytes) - やや低め
- ✓  0.00 → 成功 (52,250 bytes) - 標準ピッチ
- ✓  0.15 → 成功 (52,250 bytes) - やや高め
- ✓  0.50 → 成功 (52,250 bytes) - かなり高い
- ✓  1.00 → 成功 (52,250 bytes) - 極端に高い

**注意点:**
- 正の値 = ピッチが高くなる
- 負の値 = ピッチが低くなる
- ファイルサイズは変わらない（発声時間が同じため）
- -0.15〜0.15の範囲外は警告が出るが動作する
- 大きな値は不自然な音声になる可能性

### 3. intonationScale（抑揚）

| 項目 | 値 |
|------|-----|
| **デフォルト値** | 1.0 |
| **推奨範囲** | 0.5〜2.0 |
| **実測動作範囲** | 0.0〜3.0 (全て成功) |
| **単位** | 倍率 |

**テスト結果:**
- ✓ 0.00 → 成功 (52,250 bytes) - 完全に平坦
- ✓ 0.50 → 成功 (52,250 bytes) - 控えめ
- ✓ 1.00 → 成功 (52,250 bytes) - 標準抑揚
- ✓ 1.50 → 成功 (52,250 bytes) - 感情豊か
- ✓ 2.00 → 成功 (52,250 bytes) - 抑揚が強い
- ✓ 3.00 → 成功 (52,250 bytes) - 極端に強い

**注意点:**
- 0.0 = 完全に平坦な音声（感情がない）
- 1.0 = 標準的な抑揚
- 大きいほど抑揚が強調される
- 0.5未満や2.0超は推奨範囲外の警告が出る可能性

### 4. volumeScale（音量）

| 項目 | 値 |
|------|-----|
| **デフォルト値** | 1.0 |
| **推奨範囲** | 0.5〜2.0 |
| **実測動作範囲** | 0.0〜3.0 (全て成功) |
| **単位** | 倍率 |

**テスト結果:**
- ✓ 0.00 → 成功 (52,250 bytes) - 無音
- ✓ 0.50 → 成功 (52,250 bytes) - 小さめ
- ✓ 1.00 → 成功 (52,250 bytes) - 標準音量
- ✓ 1.50 → 成功 (52,250 bytes) - やや大きめ
- ✓ 2.00 → 成功 (52,250 bytes) - 2倍の音量
- ✓ 3.00 → 成功 (52,250 bytes) - 非常に大きい

**注意点:**
- ファイルサイズは変わらない（波形の振幅のみ変化）
- 0.0でも完全な無音ではなく極小音量
- 大きすぎる値は音割れの可能性

### 5. その他のパラメータ

#### prePhonemeLength（発声前無音）
- **デフォルト**: 0.1秒
- **推奨範囲**: 0.0〜1.0秒
- **説明**: 音声開始前の無音時間

#### postPhonemeLength（発声後無音）
- **デフォルト**: 0.5秒
- **推奨範囲**: 0.0〜2.0秒
- **説明**: 音声終了後の無音時間

#### outputSamplingRate（サンプリングレート）
- **デフォルト**: 24000 Hz
- **一般的な値**: 16000, 22050, 24000, 44100, 48000
- **説明**: 高いほど音質向上、ファイルサイズ増加

## API仕様詳細

### リクエスト形式

```python
{
    "text": "合成するテキスト",
    "speakerUuid": "d41bcbd9-f4a9-4e10-b000-7a431568dd01",
    "styleId": 100,
    "speedScale": 1.0,
    "volumeScale": 1.0,
    "pitchScale": 0.0,
    "intonationScale": 1.0,
    "prePhonemeLength": 0.1,
    "postPhonemeLength": 0.5,
    "outputSamplingRate": 24000,
    "prosodyDetail": []  # オプション
}
```

### 必須ヘッダー

```
accept: audio/wav
Content-Type: application/json
```

## トラブルシューティング

### 500 Internal Server Error

**原因:**
1. パラメータが極端すぎる（推奨範囲を大きく超える）
2. スピーカーモデルが正しく読み込まれていない
3. COEIROINKエンジンが完全に起動していない

**対処法:**
1. パラメータを推奨範囲内に設定
2. COEIROINKを再起動
3. スピーカー一覧（`/v1/speakers`）が正常に取得できるか確認

### パラメータ調整時の注意

以前のテストで以下の組み合わせで500エラーが発生:
```python
speedScale=1.3, pitchScale=0.1, intonationScale=1.5
```

**対策:**
- 複数のパラメータを同時に変更する場合は段階的にテスト
- 基本的な合成が成功してからパラメータ調整を行う
- 推奨範囲内で使用する

## まとめ

- 全てのパラメータは広範囲で動作することを確認
- 推奨範囲は自然な音声のための目安
- 推奨範囲外でも動作するが、警告が出る
- 極端な値は不自然な音声や500エラーの原因になる可能性
- 基本的には推奨範囲内での使用を推奨

## 参考情報

- OpenAPI仕様: `http://localhost:50032/openapi.json`
- Swagger UI: `http://localhost:50032/docs`
- テストスクリプト: `test_param_ranges.py`
